import{c as e,E as t,a as l,b as r,d as o,e as s,f as a,g as i,o as d,h as n,i as u,w as c,j as f,k as m,t as p,F as h,l as b,m as g,r as _,s as y,u as w,n as V,p as C,q as U,v as k,x as O,y as x,z as D,A as j}from"./vendor.33997919.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var v={data:()=>({db:null,sortOrders:[{label:"降序",value:"descending"},{label:"升序",value:"ascending"}],search:"",filterTableData:[],userCreate:"",dialogFormVisible:!1,form:{name:"",deposit:0,increase:0,decrease:0,used:0}}),methods:{handleDelete(e){!function(e,t,l){let r=e.db.transaction(["users"],"readwrite").objectStore("users").delete(t);r.onsuccess=function(t){console.log("数据删除成功"),l(e)},r.onerror=function(e){alert("数据删除失败")}}(this,e,L)},handleCreate(){this.form.name="",this.form.deposit=0,this.form.increase=0,this.form.decrease=0,this.form.used=0,this.dialogFormVisible=!0},handleEdit(){let e={name:this.form.name,deposit:Number(this.form.deposit)+Number(this.form.increase)-Number(this.form.decrease),used:this.form.used};he(this,e,L),this.search=e.name},handleExport(){let e=ge(this.db);e.onsuccess=function(t){let l=[];l=e.result;!function(e,t,l){let r=new Blob([e],{type:t}),o=URL.createObjectURL(r),s=document.createElement("a");s.download=l,s.href=o,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(JSON.stringify(l),"application/json","users.json")},e.onerror=function(e){alert("数据导出失败")}},handleImport(){var e;e=this,fetch("./src/assets/users.json").then((e=>e.json())).then((t=>{t.forEach((t=>{he(e,t,L)}))}))}},mounted(){pe(this,L)}};let S=[];class E{constructor(e,t){this.id=t,this.name=e.name,this.deposit=e.deposit,this.used=e.used,this.balance=e.deposit-e.used}}function L(t){let l=ge(t.db);l.onsuccess=function(r){S=[];let o=1;l.result.forEach((e=>{S.push(new E(e,o++))})),t.filterTableData=e((()=>S.filter((e=>!t.search||e.name.toLowerCase().includes(t.search.toLowerCase())))))},l.onerror=function(e){alert("数据刷新失败")}}const F=m("Create"),N=m("Export"),T=m("Import"),M=m(" 编辑 "),R=m("删除"),z=m("   -   "),I={class:"dialog-footer"},B=m("Cancel"),J=m(" Confirm ");v.render=function(e,b,g,_,y,w){const V=t,C=l,U=r,k=o,O=s,x=a,D=i;return d(),n(h,null,[u(V,{type:"danger",onClick:b[0]||(b[0]=e=>w.handleCreate())},{default:c((()=>[F])),_:1}),u(V,{type:"danger",onClick:b[1]||(b[1]=e=>w.handleExport())},{default:c((()=>[N])),_:1}),u(V,{type:"danger",onClick:b[2]||(b[2]=e=>w.handleImport())},{default:c((()=>[T])),_:1}),u(k,{data:y.filterTableData,style:{width:"100%"},"default-sort":{prop:"id",order:"ascending"}},{default:c((()=>[u(C,{prop:"id",label:"id",width:"80"}),u(C,{prop:"name",label:"买家",width:"80",sortable:"","sort-orders":y.sortOrders},null,8,["sort-orders"]),u(C,{prop:"balance",label:"余额",width:"80"}),u(C,{prop:"used",label:"使用",width:"90"}),u(C,{prop:"deposit",label:"总存钱量",width:"90"}),u(C,{align:"center"},{header:c((()=>[u(U,{modelValue:y.search,"onUpdate:modelValue":b[3]||(b[3]=e=>y.search=e),size:"small",placeholder:"Type to search by user"},null,8,["modelValue"])])),default:c((e=>[u(V,{size:"small",onClick:t=>{y.dialogFormVisible=!0,y.form.name=e.row.name,y.form.deposit=e.row.deposit,y.form.used=e.row.used,y.form.increase=0,y.form.decrease=0}},{default:c((()=>[M])),_:2},1032,["onClick"]),u(V,{size:"small",type:"danger",onClick:t=>w.handleDelete(e.row.name)},{default:c((()=>[R])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u(D,{modelValue:y.dialogFormVisible,"onUpdate:modelValue":b[9]||(b[9]=e=>y.dialogFormVisible=e),title:"详情/编辑"},{footer:c((()=>[f("span",I,[u(V,{onClick:b[7]||(b[7]=e=>y.dialogFormVisible=!1)},{default:c((()=>[B])),_:1}),u(V,{type:"primary",onClick:b[8]||(b[8]=e=>{y.dialogFormVisible=!1,w.handleEdit()})},{default:c((()=>[J])),_:1})])])),default:c((()=>[u(x,{model:y.form},{default:c((()=>[u(O,{label:"客户","label-width":"140px"},{default:c((()=>[u(U,{modelValue:y.form.name,"onUpdate:modelValue":b[4]||(b[4]=e=>y.form.name=e),autocomplete:"off",style:{width:"250px"}},null,8,["modelValue"])])),_:1}),u(O,{label:"总存钱数","label-width":"140px"},{default:c((()=>[m(p(y.form.deposit)+" +  ",1),u(U,{modelValue:y.form.increase,"onUpdate:modelValue":b[5]||(b[5]=e=>y.form.increase=e),autocomplete:"off",style:{width:"100px"}},null,8,["modelValue"]),z,u(U,{modelValue:y.form.decrease,"onUpdate:modelValue":b[6]||(b[6]=e=>y.form.decrease=e),autocomplete:"off",style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])],64)};let A=[];var P={data:()=>({stages:["接单","订货","厂家接单","我收到","飘洋过海","寄出","买家收到(完成)"],db:null,sortOrders:[{label:"降序",value:"descending"},{label:"升序",value:"ascending"}],search:"",filterTableData:[],userCreate:"",dialogFormVisible:!1,form:{id:-1,user:"",bag:"",buy_price:0,sell_price:0,send_price:0,sender:"",benefit:0,stage:0,update:new Date,update_str:"",history:[]},calculateUsedOriginMoney:0,calculateUsedOriginUser:"",dialogDeleteVisible:!1,deleteId:-1,deleteRadio:0,deleteMoney:0,deleteUser:""}),methods:{handleDelete(){if(1==this.deleteRadio){let e=this,t=ye(this.db,this.deleteUser);t.onsuccess=function(l){let r=t.result;r.used-=e.deleteMoney,he(e,r)},t.onerror=function(e){alert("原用户获取失败")}}!function(e,t,l){let r=e.db.transaction(["orders"],"readwrite").objectStore("orders").delete(t);r.onsuccess=function(t){console.log("数据删除成功"),l(e)},r.onerror=function(e){alert("数据删除失败")}}(this,this.deleteId,G)},handleCreate(){this.form.id=-1,this.form.user="",this.form.bag="",this.form.buy_price=0,this.form.sell_price=0,this.form.send_price=0,this.form.sender="",this.form.benefit=0,this.form.stage=0,this.form.update=new Date,this.form.history=[{stage:0,date:this.form.update}],this.form.update_str=this.dateToString(this.form.update),this.calculateUsedOriginMoney=0,this.calculateUsedOriginUser="",this.dialogFormVisible=!0},handleNext(e){let t=we(this.db,e),l=this;t.onsuccess=function(e){let r=t.result.history[t.result.history.length-1].stage;6!=r?(t.result.history.push({stage:Number(r)+1,date:new Date}),be(l,t.result,G)):alert("已完成了！")},t.onerror=function(e){alert("状态更新失败")}},showOrderDetail(){if(-1!=this.form.id){let e=we(this.db,Number(this.form.id)),t=this;e.onsuccess=function(l){t.form=new K(e.result),t.calculateUsedOriginMoney=t.form.sell_price,t.calculateUsedOriginUser=t.form.user,t.dialogFormVisible=!0},e.onerror=function(e){alert("获取订单错误,不存在这个id的订单"),t.dialogFormVisible=!1}}},handleEdit(){let e=ye(this.db,this.form.user),t=this;e.onsuccess=function(l){if(void 0===e.result)return alert("该用户不存在, 请先创建该用户"),void(t.dialogFormVisible=!1);{t.form.stage!=t.form.history[t.form.history.length-1].stage&&t.form.history.push({stage:t.form.stage,date:new Date});let l={id:t.form.id,user:t.form.user,bag:t.form.bag,buy_price:t.form.buy_price,sell_price:t.form.sell_price,send_price:t.form.send_price,sender:t.form.sender,history:t.form.history};if(be(t,l,G),l.user!=t.calculateUsedOriginUser){let r=e.result;r.used+=l.sell_price,he(t,r);let o=ye(t.db,t.calculateUsedOriginUser);o.onsuccess=function(e){let r=o.result;r.used-=l.sell_price,he(t,r)},e.onerror=function(e){alert("原用户获取失败")}}else if(l.sell_price!=t.calculateUsedOriginMoney){let r=e.result;r.used-=t.calculateUsedOriginMoney-l.sell_price,he(t,r)}t.search=l.user}},e.onerror=function(e){alert("用户获取失败")}},handleExport(){let e=_e(this.db);e.onsuccess=function(t){let l=[];l=e.result;!function(e,t,l){let r=new Blob([e],{type:t}),o=URL.createObjectURL(r),s=document.createElement("a");s.download=l,s.href=o,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(JSON.stringify(l),"application/json","orders.json")},e.onerror=function(e){alert("数据导出失败")}},handleImport(){var e;e=this,fetch("./src/assets/orders.json").then((e=>e.json())).then((t=>{t.forEach((t=>{be(e,t,G)}))}))},dateToString:e=>e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},mounted(){this.stages,pe(this,G)}};const q=["接单","订货","厂家接单","我收到","飘洋过海","寄出","买家收到(完成)"];class Y{constructor(e,t){this.stage=e,this.date=new Date(t)}}class K{constructor(e){this.history=[],this.id=e.id,this.user=e.user,this.bag=e.bag,this.buy_price=e.buy_price,this.sell_price=e.sell_price,this.send_price=e.send_price,this.sender=e.sender,this.benefit=e.sell_price-e.buy_price-e.send_price,this.stage=e.history[e.history.length-1].stage,this.stage_str=q[e.history[e.history.length-1].stage],e.history.forEach((e=>{this.history.push(new Y(e.stage,e.date))})),this.update=this.history[this.history.length-1].date,this.update_str=this.update.getFullYear()+"-"+(this.update.getMonth()+1)+"-"+this.update.getDate()}}function G(t){let l=_e(t.db);l.onsuccess=function(r){A=[],l.result.forEach((e=>{A.push(new K(e))})),t.filterTableData=e((()=>A.filter((e=>!t.search||e.user.toLowerCase().includes(t.search.toLowerCase())||e.bag.toLowerCase().includes(t.search.toLowerCase())||e.sender.toLowerCase().includes(t.search.toLowerCase())||e.update_str.includes(t.search)))))},l.onerror=function(e){alert("数据刷新失败")}}const H=m("Create"),Q=m("Export"),W=m("Import"),X=m(" 详情/编辑 "),Z=m("新状态"),$=m("删除 "),ee=m(" 0 - 接单 1 - 订货 2 - 厂家接单 3 - 我收到 4 - 飘洋过海 5 - 寄出 6 - 买家收到(完成) "),te=f("br",null,null,-1),le=f("br",null,null,-1),re=m(" 历史："),oe=f("br",null,null,-1),se={class:"dialog-footer"},ae=m("Cancel"),ie=m(" Confirm "),de=m("否"),ne=m("是"),ue={class:"dialog-footer"},ce=m("Cancel"),fe=m(" Confirm ");P.render=function(e,y,w,V,C,U){const k=t,O=l,x=r,D=o,j=s,v=a,S=i,E=b,L=g;return d(),n(h,null,[u(k,{type:"danger",onClick:y[0]||(y[0]=e=>U.handleCreate())},{default:c((()=>[H])),_:1}),u(k,{type:"danger",onClick:y[1]||(y[1]=e=>U.handleExport())},{default:c((()=>[Q])),_:1}),u(k,{type:"danger",onClick:y[2]||(y[2]=e=>U.handleImport())},{default:c((()=>[W])),_:1}),u(D,{data:C.filterTableData,style:{width:"100%"},"default-sort":{prop:"id",order:"descending"}},{default:c((()=>[u(O,{fixed:"",prop:"id",label:"id",width:"70",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{prop:"user",label:"买家",width:"80"}),u(O,{prop:"bag",label:"包名",width:"80"}),u(O,{prop:"stage_str",label:"状态",width:"120"}),u(O,{prop:"update_str",label:"最新更新日期",width:"135",sortable:"","sort-orders":C.sortOrders,"sort-by":"update"},null,8,["sort-orders"]),u(O,{prop:"benefit",label:"收入计算",width:"90",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{prop:"buy_price",label:"我卖价",width:"90",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{prop:"sell_price",label:"我买价",width:"90",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{prop:"sender",label:"快递员",width:"90",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{prop:"send_price",label:"快递费",width:"90",sortable:"","sort-orders":C.sortOrders},null,8,["sort-orders"]),u(O,{fixed:"right",align:"center",width:"250"},{header:c((()=>[u(x,{modelValue:C.search,"onUpdate:modelValue":y[3]||(y[3]=e=>C.search=e),size:"small",placeholder:"Type to search by buyer or bag or date or sender"},null,8,["modelValue"])])),default:c((e=>[u(k,{size:"small",onClick:t=>{C.form.id=e.row.id,U.showOrderDetail()}},{default:c((()=>[X])),_:2},1032,["onClick"]),u(k,{size:"small",onClick:t=>U.handleNext(e.row.id)},{default:c((()=>[Z])),_:2},1032,["onClick"]),u(k,{size:"small",type:"danger",onClick:t=>{C.deleteId=e.row.id,C.deleteMoney=e.row.sell_price,C.deleteUser=e.row.user,C.dialogDeleteVisible=!0}},{default:c((()=>[$])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u(S,{modelValue:C.dialogFormVisible,"onUpdate:modelValue":y[13]||(y[13]=e=>C.dialogFormVisible=e),title:"详情/编辑"},{footer:c((()=>[f("span",se,[u(k,{onClick:y[11]||(y[11]=e=>C.dialogFormVisible=!1)},{default:c((()=>[ae])),_:1}),u(k,{type:"primary",onClick:y[12]||(y[12]=e=>{C.dialogFormVisible=!1,U.handleEdit()})},{default:c((()=>[ie])),_:1})])])),default:c((()=>[u(v,{model:C.form},{default:c((()=>[ee,te,le,u(j,{label:"买家","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.user,"onUpdate:modelValue":y[4]||(y[4]=e=>C.form.user=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"包名","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.bag,"onUpdate:modelValue":y[5]||(y[5]=e=>C.form.bag=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"我买价","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.buy_price,"onUpdate:modelValue":y[6]||(y[6]=e=>C.form.buy_price=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"我卖价","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.sell_price,"onUpdate:modelValue":y[7]||(y[7]=e=>C.form.sell_price=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"快递费","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.send_price,"onUpdate:modelValue":y[8]||(y[8]=e=>C.form.send_price=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"快递员","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.sender,"onUpdate:modelValue":y[9]||(y[9]=e=>C.form.sender=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),u(j,{label:"收益","label-width":"140px"},{default:c((()=>[m("   "+p(C.form.benefit),1)])),_:1}),u(j,{label:"当前状态","label-width":"140px"},{default:c((()=>[u(x,{modelValue:C.form.stage,"onUpdate:modelValue":y[10]||(y[10]=e=>C.form.stage=e),autocomplete:"off",style:{width:"300px"}},null,8,["modelValue"]),m("    更新时间 "+p(C.form.update_str),1)])),_:1}),f("p",null,[re,oe,(d(!0),n(h,null,_(C.form.history,(e=>(d(),n("label",null,p(C.stages[e.stage])+" = "+p(U.dateToString(e.date))+"   ",1)))),256))])])),_:1},8,["model"])])),_:1},8,["modelValue"]),u(S,{modelValue:C.dialogDeleteVisible,"onUpdate:modelValue":y[17]||(y[17]=e=>C.dialogDeleteVisible=e),title:"是否还原金额到该买家账户"},{footer:c((()=>[f("span",ue,[u(k,{onClick:y[15]||(y[15]=e=>C.dialogDeleteVisible=!1)},{default:c((()=>[ce])),_:1}),u(k,{type:"primary",onClick:y[16]||(y[16]=e=>{C.dialogDeleteVisible=!1,U.handleDelete()})},{default:c((()=>[fe])),_:1})])])),default:c((()=>[u(v,{model:C.form},{default:c((()=>[u(j,{"label-width":"140px"},{default:c((()=>[u(L,{modelValue:C.deleteRadio,"onUpdate:modelValue":y[14]||(y[14]=e=>C.deleteRadio=e)},{default:c((()=>[u(E,{label:0},{default:c((()=>[de])),_:1}),u(E,{label:1},{default:c((()=>[ne])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])],64)};const me={data:()=>({sumDeposit:0,sumBenefit:0,activeName:"order"}),components:{Suitcase:y,User:w,CreditCard:V},methods:{handleTabClick(e,t){var l;2==e.index&&((l=this).sumBenefit=0,A.forEach((e=>l.sumBenefit+=e.benefit)),function(e){e.sumDeposit=0,S.forEach((t=>e.sumDeposit+=t.balance)),console.log(e.sumDeposit)}(this))}}};function pe(e,t){let l=indexedDB.open("bagPack",1);l.onsuccess=function(l){e.db=l.target.result,t&&t(e)},l.onerror=function(e){console.log("Database error: "+e.target.errorCode)},l.onupgradeneeded=function(t){e.db=t.target.result,e.db.createObjectStore("orders",{keyPath:"id",autoIncrement:!0}),e.db.createObjectStore("users",{keyPath:"name"})}}function he(e,t,l){let r=e.db.transaction(["users"],"readwrite").objectStore("users").put({name:t.name,deposit:t.deposit,used:t.used});r.onsuccess=function(t){console.log("数据写入成功"),l?l(e):location.reload()},r.onerror=function(e){alert("数据写入失败")}}function be(e,t,l){if(-1==t.id){let r=e.db.transaction(["orders"],"readwrite").objectStore("orders").put({user:t.user,bag:t.bag,buy_price:t.buy_price,sell_price:t.sell_price,send_price:t.send_price,sender:t.sender,history:JSON.parse(JSON.stringify(t.history))});return r.onsuccess=function(t){console.log("数据写入成功"),l(e)},void(r.onerror=function(e){alert("数据写入失败")})}let r=e.db.transaction(["orders"],"readwrite").objectStore("orders").put({id:t.id,user:t.user,bag:t.bag,buy_price:t.buy_price,sell_price:t.sell_price,send_price:t.send_price,sender:t.sender,history:JSON.parse(JSON.stringify(t.history))});r.onsuccess=function(t){console.log("数据写入成功"),l(e)},r.onerror=function(e){alert("数据写入失败")}}function ge(e){return e.transaction(["users"],"readwrite").objectStore("users").getAll()}function _e(e){return e.transaction(["orders"],"readwrite").objectStore("orders").getAll()}function ye(e,t){return e.transaction(["users"],"readwrite").objectStore("users").get(t)}function we(e,t){return e.transaction(["orders"],"readwrite").objectStore("orders").get(t)}const Ve={class:"custom-tabs-label"},Ce=f("span",null,"Orders",-1),Ue={class:"custom-tabs-label"},ke=f("span",null,"Users",-1),Oe={class:"custom-tabs-label"},xe=f("span",null,"Me",-1),De=f("br",null,null,-1),je=f("p",{style:{"font-size":"10px"}},[m(" 金额计算: "),f("br"),m(" 1. 订单的“我卖价”会自动扣除到对应买家的个人存款上 "),f("br"),m(" 2. 我的总存款 = 所有买家的余额 （所以这里不包含收益） "),f("br"),m(" 3. 我的总收益 = 所有订单的收益 （所以删除的订单，收益就会消失） ")],-1);me.render=function(e,t,l,r,o,s){const a=C("Suitcase"),i=U,n=P,h=k,b=C("User"),g=v,_=C("CreditCard"),y=O,w=x;return d(),D(w,{type:"border-card",class:"demo-tabs",modelValue:o.activeName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.activeName=e),onTabClick:s.handleTabClick},{default:c((()=>[u(h,{name:"order"},{label:c((()=>[f("span",Ve,[u(i,null,{default:c((()=>[u(a)])),_:1}),Ce])])),default:c((()=>[u(n)])),_:1}),u(h,{name:"user"},{label:c((()=>[f("span",Ue,[u(i,null,{default:c((()=>[u(b)])),_:1}),ke])])),default:c((()=>[u(g)])),_:1}),u(h,{name:"me"},{label:c((()=>[f("span",Oe,[u(i,null,{default:c((()=>[u(_)])),_:1}),xe])])),default:c((()=>[u(y,{class:"ml-2",type:"info",size:"large",modelValue:o.sumDeposit,"onUpdate:modelValue":t[0]||(t[0]=e=>o.sumDeposit=e)},{default:c((()=>[m("总存款: "+p(o.sumDeposit),1)])),_:1},8,["modelValue"]),De,u(y,{class:"ml-2",type:"info",size:"large",modelValue:o.sumBenefit,"onUpdate:modelValue":t[1]||(t[1]=e=>o.sumBenefit=e)},{default:c((()=>[m("总收益: "+p(o.sumBenefit),1)])),_:1},8,["modelValue"]),je])),_:1})])),_:1},8,["modelValue","onTabClick"])};j({setup:e=>(e,t)=>(d(),D(me))}).mount("#app");
